<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/images/LTS.png><title>Using Row-Level Security in Power BI and Power Automate - Part Two - Lindsay T Shelton</title><meta name=description content="Make sure to check out Part One before reading this!
The Use Case A brief recap - I had 19 separate Power BI reports that, for various reasons, we decided to condense into one mega report using row-level security, or RLS. This gives each lab information about their storage - how much data are they storing, what does it cost, and a list of files that haven&rsquo;t been updated in 3 years that might be prime targets for archiving."><meta name=author content="Lindsay Shelton"><meta name=generator content="Hugo 0.108.0"><link rel=stylesheet href="https://blist.vercel.app/css/styles.min.c0846aac9db6c87efe354bad93a5e4432ef35cc12598aeed07df50323381cc06.css" integrity="sha256-wIRqrJ22yH7+NUutk6XkQy7zXMElmK7tB99QMjOBzAY="><meta property="og:title" content="Using Row-Level Security in Power BI and Power Automate - Part Two"><meta property="og:description" content="Make sure to check out Part One before reading this!
The Use Case A brief recap - I had 19 separate Power BI reports that, for various reasons, we decided to condense into one mega report using row-level security, or RLS. This gives each lab information about their storage - how much data are they storing, what does it cost, and a list of files that haven&rsquo;t been updated in 3 years that might be prime targets for archiving."><meta property="og:type" content="article"><meta property="og:url" content="https://blist.vercel.app/blog/20240105using_row_level_security_in_power_bi_and_power_automate_part_two/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-01-08T09:29:05-05:00"><meta property="article:modified_time" content="2024-01-08T09:29:05-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Row-Level Security in Power BI and Power Automate - Part Two"><meta name=twitter:description content="Make sure to check out Part One before reading this!
The Use Case A brief recap - I had 19 separate Power BI reports that, for various reasons, we decided to condense into one mega report using row-level security, or RLS. This gives each lab information about their storage - how much data are they storing, what does it cost, and a list of files that haven&rsquo;t been updated in 3 years that might be prime targets for archiving."><meta itemprop=name content="Using Row-Level Security in Power BI and Power Automate - Part Two"><meta itemprop=description content="Make sure to check out Part One before reading this!
The Use Case A brief recap - I had 19 separate Power BI reports that, for various reasons, we decided to condense into one mega report using row-level security, or RLS. This gives each lab information about their storage - how much data are they storing, what does it cost, and a list of files that haven&rsquo;t been updated in 3 years that might be prime targets for archiving."><meta itemprop=datePublished content="2024-01-08T09:29:05-05:00"><meta itemprop=dateModified content="2024-01-08T09:29:05-05:00"><meta itemprop=wordCount content="1783"><meta itemprop=keywords content="power automate,power bi,row-level security,how to,"></head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative"><a href=https://blist.vercel.app/ class="capitalize font-extrabold text-2xl"><img src=/images/LTS2.png alt="Lindsay T Shelton" class="h-8 max-w-full"></a>
<button class="mobile-menu-button md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800"><li><a href=/blog>Blog</a></li><li><a href=/page/about/>About</a></li><li><a href=/tags>Tags</a></li><li class="grid place-items-center"><span class="open-search inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></span></li><li class="grid place-items-center"><span class="toggle-dark-mode inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg></span></li></ul></header><main class=flex-1><article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4"><h1 class="text-2xl font-bold mb-2">Using Row-Level Security in Power BI and Power Automate - Part Two</h1><h5 class="text-sm flex items-center flex-wrap"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><rect x="8" y="15" width="2" height="2"/></svg>Posted on
January 8, 2024
&nbsp;&bull;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
9&nbsp;minutes
&nbsp;&bull;<svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 019 0 9 9 0 019 0"/><path d="M3 6a9 9 0 019 0 9 9 0 019 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
1783&nbsp;words</h5><details id=TableOfContents class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc"><summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white"><span>Table of contents</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="6 9 12 15 18 9"/></svg></summary><ul class="mt-2 pb-4"><li><a href=#the-use-case>The Use Case</a></li><li><a href=#using-row-level-security-in-power-automate>Using Row-Level Security in Power Automate</a></li><li><a href=#gathering-the-relevant-information>Gathering the Relevant Information</a></li><li><a href=#storing-the-information>Storing the Information</a></li><li><a href=#building-the-flow>Building the Flow</a></li><li><a href=#in-conclusion>In Conclusion</a></li></ul></details><p>Make sure to check out <a href=https://www.lindsaytshelton.com/blog/20240105using_row_level_security_in_power_bi_and_power_automate/>Part One</a> before reading this!</p><h2 id=the-use-case>The Use Case</h2><p>A brief recap - I had 19 separate Power BI reports that, for various reasons, we decided to condense into one mega report using row-level security, or RLS. This gives each lab information about their storage - how much data are they storing, what does it cost, and a list of files that haven&rsquo;t been updated in 3 years that might be prime targets for archiving. This information is meant to be private to each lab - they should only see their own data.</p><p>In the first part, I set up each RLS role with its own filters in Power BI Desktop. Then I went to Power BI on the web (or Power BI Service, as it&rsquo;s apparently called) and assigned Azure AD security groups to each role, along with a few individuals. One of the roles has no filters - it&rsquo;s designed to see everything.</p><h2 id=using-row-level-security-in-power-automate>Using Row-Level Security in Power Automate</h2><p>Now, this report does no one any good if I don&rsquo;t share it out to people. Previously, I had set up a flow that looped through a SharePoint list of receipients and sent them each both a PDF of the report and a link to their individual report. That had to be re-thought with RLS in place, as the PDF generated would both not be filtered with RLS, and even if it was, it&rsquo;s not an ideal experience to get 19 pages of PDF where your data is only located on page 14.</p><p>I sat down with a friend (thanks Cat!) and after I talked out the use case, I realized I already had a flow that looped through everything I needed.</p><p>The important part of this flow is the set-up of your source data. I used a SharePoint list where I had a column for all of the information that this flow would need:</p><ul><li>The name of the lab</li><li>The user principal names (UPNs) of the people who should get each report</li><li>The report GUID from Power BI</li><li>The page name GUID for that individual tab</li><li>The dataset GUID from the semantic model</li></ul><p>The report GUID and the dataset GUID were the same for each report, but I went ahead and used the SharePoint list because that&rsquo;s what I had already set up. You can save a little effort by just making an environment variable for the report GUID and the dataset GUID.</p><h2 id=gathering-the-relevant-information>Gathering the Relevant Information</h2><p>The pieces of information that I needed before I built this flow were the report GUID, the page name GUID, and the dataset GUID.</p><p>To find the report GUID, I opened the report in Power BI on the web. Look at the URL and grab the GUID that comes after the &ldquo;reports&rdquo; part. It will be a long string of letters and numbers, and it will be the same for each report in my case.</p><p>To find the page name GUID, you need to be in the same space, just looking elsewhere in the URL. This time, you want what comes after that report GUID and the backslash, but before the &ldquo;?experience=power-bi&rdquo; at the end. This will say &ldquo;ReportSection_____&rdquo; with a shorter GUID after it. This will be different for each tab in your report. Note that you can only put one page in - putting two of these with a semi-colon in between didn&rsquo;t work for me.</p><p>To find the dataset GUID, go back to the workspace you published your report to and now look for the semantic model. Click the three ellipses next to it and click &ldquo;Settings&rdquo;. You will see the GUID in the URL that comes after &ldquo;datasets&rdquo; and before the &ldquo;?experience=power-bi&rdquo;.</p><h2 id=storing-the-information>Storing the Information</h2><p>Again, I used a SharePoint list (complete with fake columns for testing purposes) to store all of this information.</p><p><img src=/images/rowlevelsecurity7.png alt=Placeholder></p><p>(Art is my passion, clearly). Some of these columns I&rsquo;ll clean up later after I&rsquo;m sure I&rsquo;m not going to use them, like the people picker columns and the report name column.</p><p>An alternative is to build the flow inside of a solution and to use an environment variable for the two values that will stay the same if you are using one big report- the report GUID and the dataset GUID.</p><p>To do this, go into the solution you are using, and add a new environment variable. Give it a descriptive name, select &ldquo;text&rdquo; as the data type, and then simply put the relevant GUIDs into the &ldquo;default value&rdquo; field. You can then use this environment variable where I use a SharePoint dynamic content value in the flow we are about to build.</p><h2 id=building-the-flow>Building the Flow</h2><p>Now that we have all of the information we need, we can build the flow. I&rsquo;m going to start with a recurrence trigger, set to run once a month. I&rsquo;m going to use the first day of the month at 8 AM, but you can set it to whatever you want.</p><p>Next, because I&rsquo;m going to add my <a href=https://www.lindsaytshelton.com/blog/202301frankensteins-monster-error-handling-for-power-automate-cloud-flows/>Frankenstein’s Monster Error Handling</a> method, I&rsquo;ll add a Scope block. I won&rsquo;t add the error handling for now - you can see how to do that in the linked blog post, but I will nest all of my flow actions in the Scope - Try block (just a Scope block I&rsquo;ve renamed).</p><p><img src=/images/rowlevelsecurity8.png alt=Placeholder></p><p>This is the entire flow, but I&rsquo;ll break it down, especially what&rsquo;s in that &ldquo;Apply to each&rdquo;.</p><p>I am doing this in the classic designer and I&rsquo;ll tell you why. When I was first playing around with &ldquo;can I even do this?&rdquo; in a test flow, I used the new designer. I then spent two hours trying to figure out this other &ldquo;required&rdquo; field.</p><p><img src=/images/fakeout1.png alt=Placeholder></p><p>Spoiler alert - that &ldquo;identity blob&rdquo; stuff isn&rsquo;t required for RLS at all - it&rsquo;s a red herring. I&rsquo;ve raised the issue with the product team, but at the time this is being written, the bug is still there. It will run in the new designer; you just have to ignore the red asterisk.</p><p>The first block in my Scope is &ldquo;Get items&rdquo;. This one is simple - I&rsquo;m getting the items from the SharePoint list I&rsquo;ve set up as my data source. Make adjustments to this method based on your data source. Note that you don&rsquo;t need an action to fetch the environment variables - if you built this flow in the same solution, they will already be showing as an option for dynamic content.</p><p>The &ldquo;Apply to each&rdquo; is where the magic happens.</p><p><img src=/images/rowlevelsecurity9.png alt=Placeholder></p><p>It&rsquo;s still jsut three blocks inside of it, but that &ldquo;value&rdquo; is what makes it work. It is going to loop once for every row in my list - all 19 of them.</p><p>For the all-important &ldquo;Export To File for Power BI Reports&rdquo; action, this is where we are going to put in a lot of our SharePoint values to security-trim the PDF report that is generated. Note that I don&rsquo;t need to do these steps if I&rsquo;m allowed to just send a sharing link, but our use case calls for PDFs to be sent along with that sharing link, so onwards I go.</p><p>Leave most of the fields blank - you will want to make it a PDF, or whatever file format you prefer. For &ldquo;Pages pageName&rdquo;, this is where the page name GUID comes in. So if we were to look at that dynamic content value as an expression, it would read:</p><p>&ldquo;items(&lsquo;Apply_to_each&rsquo;)?[&lsquo;PageNameGuid&rsquo;]&rdquo; (with PageNameGuid being the internal name of the column I made).</p><p><img src=/images/rowlevelsecurity10.png alt=Placeholder>
<img src=/images/rowlevelsecurity11.png alt=Placeholder></p><p>The other values you need to fill in are:</p><ul><li>&ldquo;Identities Username&rdquo; - this is the UPN of the person you are sending the report to. I went ahead and just put my UPNs in a single line of text column in SharePoint with a semicolon separating the UPNs.</li><li>&ldquo;Identities Dataset&rdquo; - this is the dataset GUID from the semantic model. Either use the SharePoint dynamic content or your environment variable here.</li><li>&ldquo;Identities Roles Item&rdquo; - I have &ldquo;Lab Name&rdquo; in here. This is just the name of the role, which I matched to the Lab Name when I built them. You may need an additional column in your list to capture these if that&rsquo;s not how you did it.</li></ul><p>The rest of the values can be left blank. What this produces is single page PDFs, one for each lab, that only show the data that the lab should see. Now, you may be reading this and thing, &ldquo;If you are just printing the single page, why do you need the RLS at all?&rdquo; Well, I&rsquo;m glad you asked. I don&rsquo;t really need it for this part, but I kept on doing it for the purposes of this blog. You&rsquo;re welcome. 😂</p><p>I then added a 10 second &ldquo;Delay&rdquo; action just to give the flow a chance to catch up. I&rsquo;m not sure if this is necessary, but I&rsquo;m not taking any chances.</p><p>Then I put in a &ldquo;Send an email (V2)&rdquo; action to wrap up the flow. Here&rsquo;s what mine looks like:</p><p><img src=/images/rowlevelsecurity12.png alt=Placeholder></p><p>Right now, this is just going to my fake report recipients email list - I&rsquo;m not trying to spam 19 PIs on a Friday afternoon. I&rsquo;ve put in my various SharePoint values to make my email personalized a bit. You can see I&rsquo;ve got an environment variable in use on mine - that holds the email text so that we can change that when this flow is moved to Production without altering the flow itself (which is part of why I used the SharePoint list as a data source - changes on the fly are much easier).</p><p>Make sure you &ldquo;Show advanced options&rdquo; so that you can get your PDF attachment in there. For the attachment name, call it whatever you like, but make sure to put &ldquo;.pdf&rdquo; at the end. For the attachment content, use the &ldquo;Export To File for Power BI Reports&rdquo; dynamic content value - it&rsquo;s the file content of the PDF that was generated.</p><p>When this flow was run, I got 19 separate emails with lovely security-trimmed PDFs waiting for me!</p><h2 id=in-conclusion>In Conclusion</h2><p>That&rsquo;s the end of this tale! You now should have a working Power Automate flow that will send out personalized PDFs of your Power BI report to your recipients, with the data filtered based on the RLS you&rsquo;ve set up. I had several, &ldquo;Geez, I wish someone had documented this&rdquo; moments along the way this week, so I hope that this helps Future You even if it doesn&rsquo;t help Present Day You.</p><p>For me, now it&rsquo;s off to productionalizing this flow and moving it into Production (and praying that it runs as smoothly as it did in testing on February 1st!).</p><script async src="https://www.googletagmanager.com/gtag/js?id=G-CN3PDT3T20"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CN3PDT3T20")</script><blockquote></blockquote></article><div class="px-2 mb-2"><script src=https://giscus.app/client.js data-repo data-repo-id data-category data-category-id data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div><div class="bg-pink-100 dark:bg-gray-900"><div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center"><div><div class="text-2xl font-bold mb-2">Follow me</div><p class=opacity-60>Follow along for Power Platform, M365, and cat goodness</p></div><ul class="flex justify-center gap-x-3 flex-wrap gap-y-2"><li><a href=https://linkedin.com/in/lindsaytshelton target=_blank rel=noopener aria-label=LinkedIn class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ul></div></div></main><footer class="container p-6 mx-auto flex justify-between items-center"><span class="text-sm font-light">Copyright © 2024 - Lindsay Shelton · All rights reserved</span>
<span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg></span></footer><div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden"><div class="container max-w-3xl mx-auto p-12"><div class=relative><div class="my-4 text-center text-2xl font-bold">Search</div><span class="p-2 absolute right-0 top-0 cursor-pointer close-search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></div><input type=search class="py-2 px-3 w-full dark:text-black border dark:border-transparent" placeholder="Enter search query"><div class="search-results text-lg font-medium my-4 hidden">Results</div><ul class="search-list my-2"></ul><div class="no-results text-center my-8 hidden"><div class="text-xl font-semibold mb-2">No results found</div><p class="font-light text-sm">Try adjusting your search query</p></div></div></div><script src=https://blist.vercel.app/js/scripts.min.js></script>
<script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script><script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script></body></html>